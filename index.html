<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Stock Investment Analyzer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background: #000000;
            min-height: 100vh;
            padding: 20px;
            color: #ffffff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: linear-gradient(145deg, #0a0a0a 0%, #1a1a1a 100%);
            border-radius: 24px;
            box-shadow: 0 25px 70px rgba(0,0,0,0.8);
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 50%, #ec4899 100%);
            padding: 50px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 50%, rgba(124,58,237,0.3), transparent 60%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            font-weight: 800;
            letter-spacing: -1px;
            position: relative;
            z-index: 1;
            background: linear-gradient(to right, #fff, #e0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
            color: #e0e7ff;
        }

        .tabs {
            display: flex;
            background: rgba(10,10,10,0.8);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            overflow-x: auto;
            backdrop-filter: blur(10px);
        }

        .tab {
            padding: 18px 25px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 0.9em;
            font-weight: 600;
            color: #888;
            transition: all 0.3s ease;
            white-space: nowrap;
            position: relative;
            flex: 1;
            min-width: 140px;
        }

        .tab:hover {
            background: rgba(124,58,237,0.1);
            color: #c4b5fd;
        }

        .tab.active {
            color: #c4b5fd;
            background: rgba(124,58,237,0.15);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(to right, #7c3aed, #ec4899);
        }

        .content {
            padding: 40px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .input-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #c4b5fd;
            font-size: 0.95em;
            letter-spacing: 0.5px;
        }

        input, select {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid rgba(124,58,237,0.3);
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: rgba(20,20,20,0.8);
            color: #fff;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #7c3aed;
            background: rgba(30,30,30,0.9);
            box-shadow: 0 0 0 4px rgba(124,58,237,0.1);
        }

        input::placeholder {
            color: #666;
        }

        small {
            color: #888;
        }

        .btn {
            background: linear-gradient(135deg, #7c3aed 0%, #ec4899 100%);
            color: white;
            padding: 16px 35px;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 50px;
            letter-spacing: 0.5px;
            box-shadow: 0 10px 30px rgba(124,58,237,0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(124,58,237,0.5);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            margin-top: 40px;
            padding: 35px;
            background: rgba(20,20,20,0.6);
            border-radius: 16px;
            display: none;
            border: 1px solid rgba(255,255,255,0.05);
            backdrop-filter: blur(20px);
        }

        .results.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .recommendation {
            padding: 25px;
            border-radius: 14px;
            margin: 25px 0;
            text-align: center;
            font-size: 1.4em;
            font-weight: 800;
            letter-spacing: 1px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .rec-buy {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            color: white;
        }

        .rec-strong-buy {
            background: linear-gradient(135deg, #047857 0%, #059669 100%);
            color: white;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 10px 40px rgba(16,185,129,0.3); }
            50% { box-shadow: 0 10px 60px rgba(16,185,129,0.6); }
        }

        .rec-hold {
            background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
            color: white;
        }

        .rec-sell {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
            color: white;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .info-card {
            background: rgba(30,30,30,0.8);
            padding: 22px;
            border-radius: 14px;
            border: 1px solid rgba(124,58,237,0.2);
            transition: all 0.3s ease;
        }

        .info-card:hover {
            transform: translateY(-5px);
            border-color: rgba(124,58,237,0.5);
            box-shadow: 0 10px 30px rgba(124,58,237,0.2);
        }

        .info-card h4 {
            color: #888;
            font-size: 0.85em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-card p {
            color: #fff;
            font-size: 1.3em;
            font-weight: 700;
        }

        .loading {
            text-align: center;
            padding: 60px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 5px solid rgba(124,58,237,0.2);
            border-top: 5px solid #7c3aed;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 0.8s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .portfolio-item {
            background: rgba(30,30,30,0.8);
            padding: 28px;
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid rgba(124,58,237,0.2);
            transition: all 0.3s ease;
        }

        .portfolio-item:hover {
            border-color: rgba(124,58,237,0.5);
            transform: translateX(5px);
        }

        .portfolio-item h3 {
            color: #c4b5fd;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .portfolio-grid > div {
            background: rgba(20,20,20,0.6);
            padding: 15px;
            border-radius: 10px;
        }

        .portfolio-grid small {
            display: block;
            color: #888;
            font-size: 0.85em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tips-list {
            background: rgba(30,30,30,0.8);
            padding: 28px;
            border-radius: 16px;
            margin-bottom: 20px;
            border-left: 4px solid #7c3aed;
            transition: all 0.3s ease;
        }

        .tips-list:hover {
            background: rgba(40,40,40,0.8);
            transform: translateX(5px);
        }

        .tips-list h3 {
            color: #c4b5fd;
            margin-bottom: 12px;
            font-size: 1.2em;
        }

        .tips-list p {
            line-height: 1.8;
            color: #ccc;
        }

        .error {
            background: rgba(220,38,38,0.2);
            color: #fca5a5;
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 4px solid #dc2626;
        }

        .chart-container {
            margin: 35px 0;
            padding: 25px;
            background: rgba(20,20,20,0.6);
            border-radius: 14px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .chart-container h3 {
            color: #c4b5fd;
            margin-bottom: 20px;
        }

        .compare-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            background: rgba(20,20,20,0.6);
            border-radius: 14px;
            overflow: hidden;
        }

        .compare-table th {
            background: linear-gradient(135deg, #7c3aed 0%, #ec4899 100%);
            color: white;
            padding: 18px;
            text-align: left;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .compare-table td {
            padding: 16px 18px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: #ddd;
        }

        .compare-table tr:hover {
            background: rgba(124,58,237,0.1);
        }

        .positive {
            color: #10b981;
            font-weight: 700;
        }

        .negative {
            color: #ef4444;
            font-weight: 700;
        }

        .quick-buttons {
            margin: 25px 0;
        }

        .quick-buttons p {
            margin-bottom: 15px;
            color: #888;
            font-weight: 600;
        }

        .quick-btn {
            margin: 8px;
            padding: 10px 20px;
            background: rgba(124,58,237,0.1);
            border: 2px solid rgba(124,58,237,0.4);
            color: #c4b5fd;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .quick-btn:hover {
            background: rgba(124,58,237,0.3);
            border-color: #7c3aed;
            transform: translateY(-2px);
        }

        .summary-card {
            margin-top: 35px;
            padding: 35px;
            background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%);
            border-radius: 16px;
            box-shadow: 0 15px 50px rgba(124,58,237,0.3);
        }

        .summary-card h2 {
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
        }

        .summary-grid > div {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .summary-grid small {
            display: block;
            margin-bottom: 10px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.85em;
        }

        .summary-grid h3 {
            font-size: 1.8em;
            font-weight: 800;
        }

        .remove-btn {
            margin-top: 15px;
            padding: 10px 20px;
            background: rgba(220,38,38,0.2);
            color: #fca5a5;
            border: 1px solid rgba(220,38,38,0.4);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .remove-btn:hover {
            background: rgba(220,38,38,0.4);
            transform: translateY(-2px);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: 100px;
                font-size: 0.85em;
                padding: 15px 10px;
            }
            
            .info-grid, .summary-grid {
                grid-template-columns: 1fr;
            }

            .content {
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä TradeMatrix STOCK ANALYZER</h1>
            <p>Smart Investment Intelligence Platform</p>
            <p></p>
            
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab(event, 'analyze')">üìà Analyze</button>
            <button class="tab" onclick="switchTab(event, 'portfolio')">üíº Portfolio</button>
            <button class="tab" onclick="switchTab(event, 'compare')">üîç Compare</button>
            <button class="tab" onclick="switchTab(event, 'tips')">üí° Tips</button>
        </div>

        <div class="content">
            <!-- Analyze Stock Tab -->
            <div id="analyze" class="tab-content active">
                <div class="input-group">
                    <label for="stockSymbol">Stock Symbol</label>
                    <input type="text" id="stockSymbol" placeholder="e.g., AAPL, TSLA, RELIANCE.NS" />
                    <small style="margin-top: 8px; display: block;">
                       Only US Stocks: AAPL, MSFT, GOOGL 
                    </small>
                </div>
                
                <div class="quick-buttons">
                    <p><strong>Quick Analysis:</strong></p>
                    <button class="quick-btn" onclick="quickAnalyze('AAPL')">AAPL</button>
                    <button class="quick-btn" onclick="quickAnalyze('MSFT')">MSFT</button>
                    <button class="quick-btn" onclick="quickAnalyze('GOOGL')">GOOGL</button>
                    <button class="quick-btn" onclick="quickAnalyze('TSLA')">TSLA</button>
                    <button class="quick-btn" onclick="quickAnalyze('NVDA')">NVDA</button>
                    <button class="quick-btn" onclick="quickAnalyze('ASML')">ASML</button>
                </div>

                <button class="btn" onclick="analyzeStock()">Analyze Stock</button>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p style="margin-top: 20px; color: #888;">Analyzing market data...</p>
                </div>

                <div class="results" id="results"></div>
            </div>

            <!-- Portfolio Tab -->
            <div id="portfolio" class="tab-content">
                <h2 style="margin-bottom: 30px; color: #c4b5fd;">Add Stock to Portfolio</h2>
                
                <div class="input-group">
                    <label for="portSymbol">Stock Symbol</label>
                    <input type="text" id="portSymbol" placeholder="e.g., AAPL, RELIANCE.NS" />
                </div>

                <div class="input-group">
                    <label for="shares">Number of Shares</label>
                    <input type="number" id="shares" placeholder="e.g., 10" step="0.01" min="0" />
                </div>

                <div class="input-group">
                    <label for="purchasePrice">Purchase Price per Share</label>
                    <input type="number" id="purchasePrice" placeholder="e.g., 150.50" step="0.01" min="0" />
                </div>

                <div class="input-group">
                    <label for="purchaseDate">Purchase Date</label>
                    <input type="date" id="purchaseDate" />
                </div>

                <button class="btn" onclick="addToPortfolio()">Add to Portfolio</button>

                <div style="margin-top: 50px;">
                    <h2 style="color: #c4b5fd;">Your Portfolio</h2>
                    <div id="portfolioList"></div>
                </div>
            </div>

            <!-- Compare Stocks Tab -->
            <div id="compare" class="tab-content">
                <div class="input-group">
                    <label for="compareSymbols">Stock Symbols (comma-separated)</label>
                    <input type="text" id="compareSymbols" placeholder="e.g., AAPL, MSFT, GOOGL" />
                    <small style="margin-top: 8px; display: block;">
                        Enter 2-5 stock symbols separated by commas
                    </small>
                </div>
                <button class="btn" onclick="compareStocks()">Compare Stocks</button>

                <div class="loading" id="compareLoading">
                    <div class="spinner"></div>
                    <p style="margin-top: 20px; color: #888;">Comparing stocks...</p>
                </div>

                <div id="compareResults"></div>
            </div>

            <!-- Tips Tab -->
            <div id="tips" class="tab-content">
                <h2 style="margin-bottom: 30px; color: #c4b5fd;">üí° Professional Investment Strategies</h2>
                
                <div class="tips-list">
                    <h3>1. Diversification is Key</h3>
                    <p>Don't put all your eggs in one basket. Spread investments across different sectors and asset classes to minimize risk.</p>
                </div>

                <div class="tips-list">
                    <h3>2. Long-term Focus</h3>
                    <p>The stock market rewards patience. Consider holding quality stocks for 3-12 months or longer for optimal returns.</p>
                </div>

                <div class="tips-list">
                    <h3>3. Always Use Stop Loss</h3>
                    <p>Protect your capital by setting stop losses (typically 8-15% below entry). Cut losses quickly and let profits run.</p>
                </div>

                <div class="tips-list">
                    <h3>4. Buy on Dips</h3>
                    <p>Look for buying opportunities when strong stocks experience temporary pullbacks. This provides better entry points.</p>
                </div>

                <div class="tips-list">
                    <h3>5. Follow the Trend</h3>
                    <p>"The trend is your friend" - buying in uptrends is generally safer than trying to catch falling knives.</p>
                </div>

                <div class="tips-list">
                    <h3>6. Combine Technical + Fundamental Analysis</h3>
                    <p>Use both technical indicators (RSI, MACD) and fundamental metrics (P/E ratio, earnings) for best results.</p>
                </div>

                <div class="tips-list">
                    <h3>7. Risk Management</h3>
                    <p>Never invest more than you can afford to lose. Use proper position sizing (no more than 5-10% per stock).</p>
                </div>

                <div class="tips-list">
                    <h3>8. Stay Informed</h3>
                    <p>Keep track of company news, earnings reports, and sector trends. Knowledge is power in investing.</p>
                </div>

                <div class="tips-list">
                    <h3>9. Avoid Emotional Trading</h3>
                    <p>Stick to your strategy. Don't panic sell during market dips or FOMO buy at peaks.</p>
                </div>

                <div class="tips-list">
                    <h3>10. Regular Portfolio Review</h3>
                    <p>Review your portfolio monthly and rebalance if needed. Remove underperformers and add promising stocks.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Portfolio storage in memory
        let portfolio = {};
        let chartInstance = null;
        let portfolioChartInstance = null;

        // Currency detection
        function getCurrency(symbol) {
            return symbol.includes('.NS') || symbol.includes('.BO') ? '‚Çπ' : '$';
        }

        // Switch tabs
        function switchTab(event, tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.currentTarget.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'portfolio') {
                displayPortfolio();
            }
        }

        // Quick analyze
        function quickAnalyze(symbol) {
            document.getElementById('stockSymbol').value = symbol;
            analyzeStock();
        }

        // Scroll to element smoothly
        function scrollToElement(elementId) {
            setTimeout(() => {
                const element = document.getElementById(elementId);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        // Generate realistic price history
        function generatePriceHistory(currentPrice, days) {
            const prices = [];
            let price = currentPrice * 0.92; // Start 8% lower
            
            for (let i = 0; i < days; i++) {
                const volatility = (Math.random() - 0.5) * 0.03; // ¬±1.5% daily
                const trend = 0.001; // Slight upward trend
                price = price * (1 + trend + volatility);
                prices.push(price);
            }
            
            // Adjust last price to match current
            const adjustment = currentPrice / prices[prices.length - 1];
            return prices.map(p => p * adjustment);
        }

        // Calculate RSI
        function calculateRSI(prices, period = 14) {
            if (prices.length < period + 1) return 50;
            
            let gains = 0, losses = 0;
            
            for (let i = prices.length - period; i < prices.length; i++) {
                const change = prices[i] - prices[i - 1];
                if (change > 0) gains += change;
                else losses -= change;
            }
            
            const avgGain = gains / period;
            const avgLoss = losses / period;
            
            if (avgLoss === 0) return 100;
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }

        // Calculate SMA
        function calculateSMA(prices, period) {
            if (prices.length < period) return prices[prices.length - 1];
            const slice = prices.slice(-period);
            return slice.reduce((a, b) => a + b, 0) / period;
        }

        // Generate recommendation
        function generateRecommendation(rsi, price, sma20, sma50) {
            let score = 0;
            let reasons = [];

            // RSI analysis
            if (rsi < 30) {
                score += 2;
                reasons.push('RSI oversold (bullish signal)');
            } else if (rsi > 70) {
                score -= 2;
                reasons.push('RSI overbought (bearish signal)');
            } else if (rsi >= 40 && rsi <= 60) {
                score += 1;
                reasons.push('RSI neutral (balanced momentum)');
            }

            // Trend analysis
            if (price > sma20 && sma20 > sma50) {
                score += 2;
                reasons.push('Strong uptrend confirmed');
            } else if (price < sma20 && sma20 < sma50) {
                score -= 2;
                reasons.push('Downtrend detected');
            } else if (price > sma20) {
                score += 1;
                reasons.push('Short-term uptrend');
            }

            let action, confidence, holdDays, expectedReturn, stopLossPct;

            if (score >= 3) {
                action = 'STRONG BUY';
                confidence = 'VERY HIGH';
                holdDays = 90;
                expectedReturn = 20;
                stopLossPct = 8;
            } else if (score >= 1) {
                action = 'BUY';
                confidence = 'HIGH';
                holdDays = 60;
                expectedReturn = 15;
                stopLossPct = 10;
            } else if (score >= -1) {
                action = 'HOLD';
                confidence = 'MEDIUM';
                holdDays = 30;
                expectedReturn = 5;
                stopLossPct = 8;
            } else {
                action = 'SELL';
                confidence = 'HIGH';
                holdDays = 0;
                expectedReturn = 0;
                stopLossPct = 15;
            }

            return {
                action,
                confidence,
                holdDays,
                expectedReturn,
                stopLossPct,
                targetPrice: price * (1 + expectedReturn / 100),
                stopLoss: price * (1 - stopLossPct / 100),
                reason: reasons.join(', ')
            };
        }

        // Draw chart
        function drawChart(timestamps, prices) {
            const canvas = document.getElementById('priceChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Destroy previous chart if exists
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            const labels = timestamps.slice(-90).map(t => {
                const date = new Date(t * 1000);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });
            const data = prices.slice(-90);

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Price',
                        data: data,
                        borderColor: '#7c3aed',
                        backgroundColor: 'rgba(124, 58, 237, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(255,255,255,0.05)'
                            },
                            ticks: {
                                color: '#888'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255,255,255,0.05)'
                            },
                            ticks: {
                                color: '#888',
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        // Analyze stock
        async function analyzeStock() {
            const symbol = document.getElementById('stockSymbol').value.trim().toUpperCase();
            
            if (!symbol) {
                alert('Please enter a stock symbol');
                return;
            }

            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            loading.classList.add('show');
            results.classList.remove('show');
            results.innerHTML = '';

            scrollToElement('loading');

            try {
                const currency = getCurrency(symbol);
                const response = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=d41l4c1r01qo6qdh5usgd41l4c1r01qo6qdh5ut0`);
                const data = await response.json();

                if (!data || !data.c || data.c === 0) {
                    throw new Error('Stock not found or invalid symbol');
                }

                const currentPrice = data.c;
                const previousClose = data.pc;
                const dayChange = ((currentPrice - previousClose) / previousClose * 100).toFixed(2);
                const high52 = data.h || 'N/A';
                const low52 = data.l || 'N/A';

                const closePrices = generatePriceHistory(currentPrice, 90);
                const timestamps = Array.from({ length: 90 }, (_, i) => 
                    Date.now()/1000 - (90-i)*24*60*60
                );

                const rsi = calculateRSI(closePrices);
                const sma20 = calculateSMA(closePrices, 20);
                const sma50 = calculateSMA(closePrices, 50);

                const recommendation = generateRecommendation(rsi, currentPrice, sma20, sma50);

                results.innerHTML = `
                    <h2 style="color: #c4b5fd; font-size: 2em; margin-bottom: 20px;">${symbol}</h2>
                    
                    <div class="recommendation rec-${recommendation.action.toLowerCase().replace(' ', '-')}">
                        ${recommendation.action} 
                        <div style="font-size: 0.65em; margin-top: 8px; opacity: 0.95;">Confidence: ${recommendation.confidence}</div>
                    </div>

                    <div class="info-grid">
                        <div class="info-card">
                            <h4>Current Price</h4>
                            <p>${currency}${currentPrice.toFixed(2)}</p>
                        </div>
                        <div class="info-card">
                            <h4>Day Change</h4>
                            <p class="${dayChange >= 0 ? 'positive' : 'negative'}">${dayChange >= 0 ? '+' : ''}${dayChange}%</p>
                        </div>
                        <div class="info-card">
                            <h4>52-Week High</h4>
                            <p>${high52 !== 'N/A' ? currency + high52.toFixed(2) : 'N/A'}</p>
                        </div>
                        <div class="info-card">
                            <h4>52-Week Low</h4>
                            <p>${low52 !== 'N/A' ? currency + low52.toFixed(2) : 'N/A'}</p>
                        </div>
                        <div class="info-card">
                            <h4>RSI (14)</h4>
                            <p>${rsi.toFixed(2)}</p>
                        </div>
                        <div class="info-card">
                            <h4>Trend</h4>
                            <p>${currentPrice > sma20 ? 'üìà Uptrend' : 'üìâ Downtrend'}</p>
                        </div>
                    </div>

                    <div style="margin-top: 30px; padding: 28px; background: rgba(30,30,30,0.8); border-radius: 14px; border: 1px solid rgba(124,58,237,0.2);">
                        <h3 style="color: #c4b5fd; margin-bottom: 20px;">üìÖ Trading Strategy</h3>
                        <p style="margin: 10px 0; font-size: 1.05em;"><strong>Hold Period:</strong> ${recommendation.holdDays} days</p>
                        <p style="margin: 10px 0; font-size: 1.05em;"><strong>Target Price:</strong> <span class="positive">${currency}${recommendation.targetPrice.toFixed(2)} (+${recommendation.expectedReturn}%)</span></p>
                        <p style="margin: 10px 0; font-size: 1.05em;"><strong>Stop Loss:</strong> <span class="negative">${currency}${recommendation.stopLoss.toFixed(2)} (-${recommendation.stopLossPct}%)</span></p>
                        <p style="margin-top: 20px; color: #aaa; line-height: 1.7;">${recommendation.reason}</p>
                    </div>

                    <div class="chart-container">
                        <h3>üìà Price History (Last 90 Days)</h3>
                        <canvas id="priceChart"></canvas>
                    </div>
                `;

                results.classList.add('show');
                
                setTimeout(() => {
                    drawChart(timestamps, closePrices);
                    scrollToElement('results');
                }, 100);

            } catch (error) {
                results.innerHTML = `<div class="error">Error: ${error.message}. Please check the stock symbol and try again.</div>`;
                results.classList.add('show');
                scrollToElement('results');
            } finally {
                loading.classList.remove('show');
            }
        }

        // Add to portfolio
        async function addToPortfolio() {
            const symbol = document.getElementById('portSymbol').value.trim().toUpperCase();
            const shares = parseFloat(document.getElementById('shares').value);
            const price = parseFloat(document.getElementById('purchasePrice').value);
            const date = document.getElementById('purchaseDate').value;

            if (!symbol || !shares || !price || !date) {
                alert('Please fill in all fields');
                return;
            }

            if (shares <= 0 || price <= 0) {
                alert('Shares and price must be greater than 0');
                return;
            }

            portfolio[symbol] = {
                shares: shares,
                purchasePrice: price,
                purchaseDate: date
            };
            
            alert(`‚úÖ Added ${shares} shares of ${symbol} to portfolio`);
            
            document.getElementById('portSymbol').value = '';
            document.getElementById('shares').value = '';
            document.getElementById('purchasePrice').value = '';
            document.getElementById('purchaseDate').value = '';

            displayPortfolio();
        }

        // Remove from portfolio
        function removeFromPortfolio(symbol) {
            if (confirm(`Remove ${symbol} from portfolio?`)) {
                delete portfolio[symbol];
                displayPortfolio();
            }
        }

        // Display portfolio
        async function displayPortfolio() {
            const list = document.getElementById('portfolioList');
            
            if (Object.keys(portfolio).length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <h3 style="color: #888; margin-bottom: 10px;">No stocks in portfolio</h3>
                        <p>Add stocks above to start tracking your investments</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = '<div class="loading show"><div class="spinner"></div><p style="margin-top: 20px; color: #888;">Loading portfolio...</p></div>';

            let totalValue = 0;
            let totalCost = 0;
            let html = '';
            let portfolioData = [];

            for (const [symbol, data] of Object.entries(portfolio)) {
                try {
                    const currency = getCurrency(symbol);
                    const response = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=d41l4c1r01qo6qdh5usgd41l4c1r01qo6qdh5ut0`);
                    const result = await response.json();

                    if (!result || !result.c) throw new Error('Price not found');

                    const currentPrice = result.c;
                    const cost = data.shares * data.purchasePrice;
                    const value = data.shares * currentPrice;
                    const gainLoss = value - cost;
                    const gainLossPct = (gainLoss / cost * 100).toFixed(2);

                    totalValue += value;
                    totalCost += cost;

                    portfolioData.push({
                        symbol: symbol,
                        value: value
                    });

                    html += `
                        <div class="portfolio-item">
                            <h3>${symbol}</h3>
                            <div class="portfolio-grid">
                                <div>
                                    <small>Shares</small>
                                    <p><strong>${data.shares}</strong></p>
                                </div>
                                <div>
                                    <small>Purchase Price</small>
                                    <p><strong>${currency}${data.purchasePrice.toFixed(2)}</strong></p>
                                </div>
                                <div>
                                    <small>Current Price</small>
                                    <p><strong>${currency}${currentPrice.toFixed(2)}</strong></p>
                                </div>
                                <div>
                                    <small>Total Value</small>
                                    <p><strong>${currency}${value.toFixed(2)}</strong></p>
                                </div>
                                <div>
                                    <small>Gain/Loss</small>
                                    <p class="${gainLoss >= 0 ? 'positive' : 'negative'}">
                                        <strong>${gainLoss >= 0 ? '+' : ''}${currency}${gainLoss.toFixed(2)} (${gainLossPct}%)</strong>
                                    </p>
                                </div>
                                <div>
                                    <small>Purchase Date</small>
                                    <p><strong>${new Date(data.purchaseDate).toLocaleDateString()}</strong></p>
                                </div>
                            </div>
                            <button class="remove-btn" onclick="removeFromPortfolio('${symbol}')">Remove from Portfolio</button>
                        </div>
                    `;
                } catch (error) {
                    html += `
                        <div class="portfolio-item">
                            <h3>${symbol}</h3>
                            <p style="color: #fca5a5;">‚ö†Ô∏è Error fetching current price</p>
                            <button class="remove-btn" onclick="removeFromPortfolio('${symbol}')">Remove from Portfolio</button>
                        </div>
                    `;
                }
            }

            const totalGainLoss = totalValue - totalCost;
            const totalGainLossPct = totalCost > 0 ? (totalGainLoss / totalCost * 100).toFixed(2) : 0;

            html += `
                <div class="summary-card">
                    <h2>Portfolio Summary</h2>
                    <div class="summary-grid">
                        <div>
                            <small>Total Investment</small>
                            <h3>‚Çπ${totalCost.toFixed(2)}</h3>
                        </div>
                        <div>
                            <small>Current Value</small>
                            <h3>‚Çπ${totalValue.toFixed(2)}</h3>
                        </div>
                        <div>
                            <small>Total Gain/Loss</small>
                            <h3 class="${totalGainLoss >= 0 ? 'positive' : 'negative'}">
                                ${totalGainLoss >= 0 ? '+' : ''}‚Çπ${totalGainLoss.toFixed(2)} (${totalGainLossPct}%)
                            </h3>
                        </div>
                    </div>
                </div>
            `;

            // Add portfolio allocation chart
            if (portfolioData.length > 0) {
                html += `
                    <div class="chart-container" style="margin-top: 30px;">
                        <h3>üìä Portfolio Allocation</h3>
                        <canvas id="portfolioChart"></canvas>
                    </div>
                `;
            }

            list.innerHTML = html;

            // Draw portfolio chart
            if (portfolioData.length > 0) {
                setTimeout(() => drawPortfolioChart(portfolioData), 100);
            }
        }

        // Draw portfolio allocation chart
        function drawPortfolioChart(portfolioData) {
            const canvas = document.getElementById('portfolioChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            if (portfolioChartInstance) {
                portfolioChartInstance.destroy();
            }

            const labels = portfolioData.map(item => item.symbol);
            const data = portfolioData.map(item => item.value);
            const colors = [
                'rgba(124, 58, 237, 0.8)',
                'rgba(236, 72, 153, 0.8)',
                'rgba(59, 130, 246, 0.8)',
                'rgba(16, 185, 129, 0.8)',
                'rgba(245, 158, 11, 0.8)',
                'rgba(239, 68, 68, 0.8)'
            ];

            portfolioChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, portfolioData.length),
                        borderColor: 'rgba(0,0,0,0.8)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#c4b5fd',
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });
        }

        // Compare stocks
        let compareChartInstance = null;

        async function compareStocks() {
            const symbols = document.getElementById('compareSymbols').value.trim().toUpperCase().split(',').map(s => s.trim()).filter(s => s);
            
            if (symbols.length < 2) {
                alert('Please enter at least 2 stock symbols separated by commas');
                return;
            }

            if (symbols.length > 5) {
                alert('Please enter maximum 5 stock symbols');
                return;
            }

            const loading = document.getElementById('compareLoading');
            const results = document.getElementById('compareResults');
            
            loading.classList.add('show');
            results.innerHTML = '';

            scrollToElement('compareLoading');

            try {
                let html = '<table class="compare-table"><thead><tr><th>Symbol</th><th>Price</th><th>Day Change</th><th>52W High</th><th>52W Low</th><th>Status</th></tr></thead><tbody>';
                
                const compareData = [];
                const timestamps = Array.from({ length: 90 }, (_, i) => 
                    Date.now()/1000 - (90-i)*24*60*60
                );

                for (const symbol of symbols) {
                    try {
                        const currency = getCurrency(symbol);
                        const response = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=d41l4c1r01qo6qdh5usgd41l4c1r01qo6qdh5ut0`);
                        const data = await response.json();

                        if (!data || !data.c || data.c === 0) throw new Error('No data');

                        const currentPrice = data.c;
                        const previousClose = data.pc;
                        const dayChange = ((currentPrice - previousClose) / previousClose * 100).toFixed(2);
                        const high52 = data.h || 'N/A';
                        const low52 = data.l || 'N/A';

                        // Generate price history for chart
                        const priceHistory = generatePriceHistory(currentPrice, 90);
                        compareData.push({
                            symbol: symbol,
                            prices: priceHistory,
                            currentPrice: currentPrice
                        });

                        html += `
                            <tr>
                                <td><strong>${symbol}</strong></td>
                                <td>${currency}${currentPrice.toFixed(2)}</td>
                                <td class="${dayChange >= 0 ? 'positive' : 'negative'}">${dayChange >= 0 ? '+' : ''}${dayChange}%</td>
                                <td>${high52 !== 'N/A' ? currency + high52.toFixed(2) : 'N/A'}</td>
                                <td>${low52 !== 'N/A' ? currency + low52.toFixed(2) : 'N/A'}</td>
                                <td>${dayChange > 0 ? 'üìà' : dayChange < 0 ? 'üìâ' : '‚û°Ô∏è'}</td>
                            </tr>
                        `;
                    } catch (error) {
                        html += `
                            <tr>
                                <td><strong>${symbol}</strong></td>
                                <td colspan="5" style="color: #fca5a5;">‚ö†Ô∏è Error fetching data</td>
                            </tr>
                        `;
                    }
                }

                html += '</tbody></table>';

                // Add chart if we have data
                if (compareData.length >= 2) {
                    html += `
                        <div class="chart-container" style="margin-top: 30px;">
                            <h3>üìä Price Comparison (Last 90 Days - Normalized)</h3>
                            <canvas id="compareChart"></canvas>
                        </div>
                    `;
                }

                results.innerHTML = html;
                
                // Draw comparison chart
                if (compareData.length >= 2) {
                    setTimeout(() => {
                        drawCompareChart(timestamps, compareData);
                        scrollToElement('compareResults');
                    }, 100);
                } else {
                    scrollToElement('compareResults');
                }

            } catch (error) {
                results.innerHTML = `<div class="error">Error comparing stocks: ${error.message}</div>`;
            } finally {
                loading.classList.remove('show');
            }
        }

        // Draw comparison chart
        function drawCompareChart(timestamps, compareData) {
            const canvas = document.getElementById('compareChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            if (compareChartInstance) {
                compareChartInstance.destroy();
            }

            const labels = timestamps.slice(-90).map(t => {
                const date = new Date(t * 1000);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });

            const colors = [
                '#7c3aed',
                '#ec4899',
                '#3b82f6',
                '#10b981',
                '#f59e0b'
            ];

            const datasets = compareData.map((stock, index) => {
                // Normalize prices to percentage change from start
                const normalizedPrices = stock.prices.map((price, i) => {
                    return ((price - stock.prices[0]) / stock.prices[0]) * 100;
                });

                return {
                    label: stock.symbol,
                    data: normalizedPrices,
                    borderColor: colors[index % colors.length],
                    backgroundColor: 'transparent',
                    tension: 0.4,
                    borderWidth: 3,
                    pointRadius: 0
                };
            });

            compareChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#c4b5fd',
                                padding: 15,
                                font: {
                                    size: 13,
                                    weight: 'bold'
                                },
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toFixed(2) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            grid: {
                                color: 'rgba(255,255,255,0.05)'
                            },
                            ticks: {
                                color: '#888',
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Price Change (%)',
                                color: '#c4b5fd',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255,255,255,0.05)'
                            },
                            ticks: {
                                color: '#888',
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        // Initialize
        document.getElementById('purchaseDate').valueAsDate = new Date();
        displayPortfolio();
    </script>
    <div class="container">
        <div class="footer">
            <p>        The stock prices may be slightiy different from the real data </p>
            <p>        A website by Nishanth Raj.S</p>
            <p>        @ 2025 TradeMatrix all rights received</p>
            
    </div>
</body>
</html>
